<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: url("photo_2025-08-20_13-14-09.jpg") no-repeat center center / cover;
    color: #fff;
    font-family: system-ui, sans-serif;
    margin: 0;
    padding: 0;
    overflow: hidden;
    position: relative;
  }
  h2 { margin: 0 0 12px; color: black; text-shadow: none; }
  .wheel-selection { display: flex; gap: 12px; margin-bottom: 12px; }
  .wheel-selection button {
    padding: 8px 16px; font-size: 16px; font-weight: bold;
    border: none; border-radius: 25px;
    background: linear-gradient(90deg, #6a0dad, #9b59b6);
    color: #fff; cursor: pointer;
    transition: transform .15s ease, background .3s ease;
  }
  .wheel-selection button:hover { transform: scale(1.05); }
  .wheel-wrap { position: relative; display: flex; flex-direction: column; align-items: center; gap: 12px; }
  #pointer {
    position: absolute; top: -10px; left: 50%; transform: translateX(-50%) rotate(180deg);
    width: 0; height: 0;
    border-left: 18px solid transparent; border-right: 18px solid transparent;
    border-bottom: 38px solid gold;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.7));
    animation: pulsePointer 1.2s infinite; z-index: 2;
  }
  @keyframes pulsePointer {
    0%,100% { transform: translateX(-50%) rotate(180deg) scale(1); }
    50% { transform: translateX(-50%) rotate(180deg) scale(1.1); }
  }
  canvas#wheel {
    border-radius: 50%;
    box-shadow: 0 0 25px rgba(255,255,255,0.2), inset 0 0 40px rgba(0,0,0,0.6);
    display: block; width: 380px; height: 380px;
    background: radial-gradient(circle, #111 70%, #000);
    transition: transform 0.4s ease;
  }
  canvas#wheel:hover { transform: scale(1.02); }
  #spin {
    padding: 12px 24px; font-size: 18px; font-weight: bold;
    border: none; border-radius: 50px;
    background: linear-gradient(90deg, #ff416c, #ff4b2b);
    color: #fff; cursor: pointer;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5), 0 0 15px rgba(255,75,43,0.7);
    transition: transform .15s ease, background .4s ease, box-shadow .4s ease;
  }
  #spin:hover {
    transform: scale(1.05);
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    box-shadow: 0 5px 25px rgba(0,0,0,0.6), 0 0 25px rgba(255,75,43,0.9);
  }
  #spin:active { transform: scale(0.98); }
  #spin:disabled { opacity: 0.6; cursor: not-allowed; }
  #result { min-height: 1.4em; font-size: 20px; margin: 6px 0 0; text-shadow: 0 0 8px #ffd700; text-align: center; }
  .promo { display: flex; gap: 6px; margin-top: 12px; flex-wrap: wrap; justify-content: center; }
  .promo input {
    padding: 8px 12px; border-radius: 6px; border: none; font-size: 14px;
    background: rgba(255,255,255,0.1); color: #fff; outline: none;
  }
  .promo input::placeholder { color: #ccc; }
</style>
</head>
<body>

<h2>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã üé°</h2>

<div class="wheel-selection">
  <button data-wheel="purple">–§–∏–æ–ª–µ—Ç–æ–≤–∞—è –∫–æ—Ä–æ–±–∫–∞</button>
  <button data-wheel="blue">–°–∏–Ω—è—è –∫–æ—Ä–æ–±–∫–∞</button>
</div>

<div class="wheel-wrap">
  <div id="pointer"></div>
  <canvas id="wheel" width="420" height="420" aria-label="–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã"></canvas>
  <button id="spin">–ö—Ä—É—Ç–∏—Ç—å</button>
</div>

<p id="result"></p>

<div class="promo">
  <input type="text" id="promoCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const tg = window.Telegram.WebApp;
tg.expand();

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const result = document.getElementById('result');
const btn = document.getElementById('spin');
const promoInput = document.getElementById('promoCode');
const wheelButtons = document.querySelectorAll('.wheel-selection button');

const colors = ['#e74c3c','#3498db','#f1c40f','#2ecc71','#9b59b6','#e67e22','#1abc9c','#ff6b81','#ffa502','#3742fa'];

const wheels = {
  purple: ['1500 —Ä—É–±','1000 —Ä—É–±','700 —Ä—É–±','500 —Ä—É–±','—Ö2 –∫ –≤—ã–∏–≥—Ä—ã—à—É','—Ö3 –∫ –≤—ã–∏–≥—Ä—ã—à—É','–∏–º–µ–Ω–Ω–æ–π –≤–∏–Ω–∏–ª + –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø—Ä–∏–≤–∞—Ç–∫–∏'],
  blue: ['1000 —Ä—É–±','500 —Ä—É–±','300 —Ä—É–±','—Ö2 –∫ –≤—ã–∏–≥—Ä—ã—à—É','—Ö3 –∫ –≤—ã–∏–≥—Ä—ã—à—É']
};

let sectors = [...wheels.purple];
let angle = 0;
let spinning = false;

function wrapText(context, text, x, y, maxWidth, lineHeight) {
  const words = text.split(' ');
  let line = '';
  const lines = [];
  for (let n = 0; n < words.length; n++) {
    const testLine = line + words[n] + ' ';
    const metrics = context.measureText(testLine);
    const testWidth = metrics.width;
    if (testWidth > maxWidth && n > 0) {
      lines.push(line);
      line = words[n] + ' ';
    } else {
      line = testLine;
    }
  }
  lines.push(line);
  for (let i = 0; i < lines.length; i++) {
    context.fillText(lines[i], x, y + (i * lineHeight));
  }
}

function drawWheel() {
  const radius = canvas.width / 2;
  const arc = (2 * Math.PI) / sectors.length;
  for (let i = 0; i < sectors.length; i++) {
    const start = i * arc;
    const g = ctx.createRadialGradient(radius, radius, 24, radius, radius, radius);
    g.addColorStop(0, '#fff');
    g.addColorStop(1, colors[i % colors.length]);
    ctx.fillStyle = g;
    ctx.beginPath();
    ctx.moveTo(radius, radius);
    ctx.arc(radius, radius, radius, start, start + arc);
    ctx.lineTo(radius, radius);
    ctx.fill();
    ctx.strokeStyle = '#222'; 
    ctx.lineWidth = 2; 
    ctx.stroke();
    ctx.save();
    ctx.translate(radius, radius);
    ctx.rotate(start + arc / 2);
    ctx.textAlign = 'right'; 
    ctx.fillStyle = '#fff'; 
    ctx.font = 'bold 16px system-ui';
    ctx.shadowColor = 'black'; 
    ctx.shadowBlur = 4;
    wrapText(ctx, sectors[i], radius - 16, -10, 100, 18);
    ctx.restore();
  }
  ctx.beginPath(); 
  ctx.fillStyle = '#222'; 
  ctx.arc(radius, radius, 22, 0, Math.PI * 2); 
  ctx.fill();
}

function sendResultToBot(prize) {
  if (!tg.initDataUnsafe || !tg.initDataUnsafe.user) {
    alert("‚ùå –û—Ç–∫—Ä–æ–π –∫–æ–ª–µ—Å–æ –≤–Ω—É—Ç—Ä–∏ Telegram!");
    return;
  }
  const user = tg.initDataUnsafe.user;
  const data = {
      prize: prize,
      user_id: user.id,
      username: user.username || "",
      first_name: user.first_name || "–ò–≥—Ä–æ–∫",
      promo_code: promoInput.value.trim().toUpperCase()
  };
  tg.sendData(JSON.stringify(data));
}

function rotateWheel() {
  if (spinning) return;

  const code = promoInput.value.trim().toUpperCase();
  if (!code) {
    alert('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!');
    return;
  }

  spinning = true;
  btn.disabled = true;
  const randomSpin = Math.floor(Math.random() * 360) + 1440;
  const finalAngle = angle + randomSpin;
  const duration = 4200;
  const startTime = performance.now();

  function animate(now) {
    const t = Math.min((now - startTime) / duration, 1);
    const ease = 1 - Math.pow(1 - t, 4);
    const currentAngle = angle + (finalAngle - angle) * ease;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save(); 
    ctx.translate(canvas.width / 2, canvas.height / 2);
    ctx.rotate(currentAngle * Math.PI / 180);
    ctx.translate(-canvas.width / 2, -canvas.height / 2);
    drawWheel(); 
    ctx.restore();
    if (t < 1) requestAnimationFrame(animate);
    else {
      angle = ((finalAngle % 360) + 360) % 360;
      const sectorAngle = 360 / sectors.length;
      const pointerAngle = 270;
      const pickedIndex = Math.floor(((pointerAngle - angle + 360) % 360) / sectorAngle);
      const prize = sectors[pickedIndex];
      result.textContent = '–í—ã–ø–∞–ª–æ: ' + prize;
      sendResultToBot(prize);
      spinning = false; 
      btn.disabled = false;
    }
  }
  requestAnimationFrame(animate);
}

wheelButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const wheel = btn.getAttribute('data-wheel');
    sectors = [...wheels[wheel]];
    drawWheel();
  });
});

drawWheel();
btn.addEventListener('click', rotateWheel);
</script>
</body>
</html>




